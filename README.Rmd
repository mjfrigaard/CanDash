---
title: "CanDash - Cannabis Dashboards"
output: github_document
---

```{r setup, include=FALSE}
# create figs folder ----
if (!file.exists("figs/")) {
    dir.create("figs/")
}
# create docs folder ----
if (!file.exists("docs/")) {
    dir.create("docs/")
}
library(knitr)
library(rmdformats)
library(tidyverse)
library(devtools)
library(hrbrthemes)
library(vctrs)
library(inspectdf)
# chunks set options
knitr::opts_chunk$set(
  echo = TRUE, # show/hide all code
  # results = "hide", # hide results
  tidy = FALSE, # cleaner code printing
  comment = "#> ", # better console printing
  eval = TRUE, # turn this to FALSE stop code chunks from running
  message = TRUE, # show messages
  warning = FALSE, # show warnings
  size = "small", # size of the text
  fig.path = "figs/", # location of files
  fig.height = 5.5, # height of figures
  fig.width = 8 # width of figures
) # width of figures
# knit set options
knitr::opts_knit$set(
  width = 78,
  progress = FALSE
)
# base options
base::options(
  tibble.print_max = 25,
  tibble.width = 78,
   max.print = 999999,
  scipen = 100000000
)
# set the theme here for ggplot2
```

## Overview 

File/folder structure

```{r , echo=FALSE}
fs::dir_tree(".", recurse = FALSE)
```

## The data

The data model for the CanDash application had to be constructed from a few different sources. First, a list of products, brands, and other categorical data were imported form the Kushy application on Github. You can find the original data for this project [here](https://github.com/kushyapp/cannabis-dataset). 

We had to simulate the cost data for the products in the `Products` and `Brands` tables. We used the online retail data from the [UCI Machine Learning Laboratory](https://archive.ics.uci.edu/ml/datasets/online+retail).

```{r data-objects}
fs::dir_tree("data", recurse = TRUE)
```

## Import

The data for the dashboard are imported below. 

```{r import-CannabisWowData, message=FALSE, warning=FALSE}
# fs::dir_tree("data/processed/")
CannabisWowData <- read_csv("data/processed/2020-04-17-CannabisWowData.csv")
CannabisWowData %>% dplyr::glimpse(78)
```

## Date ranges 

```{r date-ranges}
CannabisWowData %>% 
  dplyr::summarize(min_invoice_date = min(invoice_date, na.rm = TRUE),
                   max_invoice_date = max(invoice_date, na.rm = TRUE),
                   min_week_year = min(week_year, na.rm = TRUE),
                   max_week_year = max(week_year, na.rm = TRUE))
```

These will help in determining what inputs to set on the dashboard. 

### Missing data 

These data are missing from the final `CannabisWowData`.

```{r NAProducts}
NAProducts <- inspectdf::inspect_na(df1 = CannabisWowData)
NAProducts %>% inspectdf::show_plot(text_labels = TRUE) 
```

## Categorical data 

These are the categorical variables in the `CannabisWowData`. 

```{r CannabisWowCats}
CannabisWowCats <- CannabisWowData %>% 
  dplyr::select_if(is.character) %>% 
  inspectdf::inspect_cat()
CannabisWowCats %>% inspectdf::show_plot(text_labels = TRUE) 
```

We can see the overwhelming number of the data are from `California`, in the months of `Nov/Oct`, etc.

## Numerical data 

These are the categorical variables in the `CannabisWowData`. 

```{r CannabisWowNums}
CannabisWowNums <- CannabisWowData %>%
  # get numeric variables 
  dplyr::select(c(amnt_per_invoice, 
                  quantity, 
                  unit_price, 
                  prod_name_count)) %>% 
  inspectdf::inspect_num()
CannabisWowNums %>% 
  # plot these with color and layout
  inspectdf::show_plot(col_palette = 2, 
                       plot_layout = c(2, 2)) 
```

Here we can see the `amnt_per_invoice`, `prod_name_count`, `quantity`, and `unit_price` are skewed heavily towards 0. 



